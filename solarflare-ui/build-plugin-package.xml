<!-- Copyright (c) 2012-2016 VMware, Inc. All rights reserved. -->
<project name="build-plugin-package" default="build" >
   <description>
       Creates the plugin package folder from solarflare-ui and solarflare-service:
             solarflare
                  plugin-package.xml
                  /plugins
                     gson-2.3.1.jar
					 vim25.jar
                     solarflare-ui.war
                     solarflare-service.jar

   </description>

   <property environment="env"/>
   <property name="VSPHERE_SDK_HOME" value="${env.VSPHERE_SDK_HOME}"/>
   <property name="BUILD_DIR" value="${basedir}/target"/>
   <property name="SERVICE_DIR" value="${basedir}/../solarflare-service"/>

   <target name="build" depends="buildUiWar, buildServiceJar, createPluginPackageDir"/>

   <target name="buildUiWar">
      <ant antfile="${basedir}/build-war.xml" dir="${basedir}" inheritAll="false"/>
   </target>

   <target name="buildServiceJar">
      <ant antfile="${SERVICE_DIR}/build-java.xml" dir="${SERVICE_DIR}" inheritAll="false"/>
   </target>

   <target name="createPluginPackageDir">
      <mkdir dir="${BUILD_DIR}/solarflare" />
      <mkdir dir="${BUILD_DIR}/solarflare/plugins" />
      <copy todir="${BUILD_DIR}/solarflare" file="plugin-package.xml"/>
      <copy todir="${BUILD_DIR}/solarflare/plugins" file="${BUILD_DIR}/solarflare-ui.war"/>
      <copy todir="${BUILD_DIR}/solarflare/plugins" file="${SERVICE_DIR}/target/solarflare-service.jar"/>
      <copy todir="${BUILD_DIR}/solarflare/plugins" file="${VSPHERE_SDK_HOME}/libs/gson-2.3.1.jar"/>
	  <copy todir="${BUILD_DIR}/solarflare/plugins" file="${VSPHERE_SDK_HOME}/libs/vim25.jar"/>
     </target>

</project>
